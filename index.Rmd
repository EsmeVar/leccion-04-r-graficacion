---
title: "El lenguaje de programación R - Graficación"
author: "Manuel Vargas"
date: "2020-04-23"
output:
  html_document:
    theme: readable    
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Recursos de interés
* Libro [_R Graphics Cookbook_, de Winston Chang](https://r-graphics.org/).
* Sitio web sobre visualización de datos: [From data to Viz | Find the graphic you need](https://www.data-to-viz.com/).

* Sitio web del curso: [GF-0604: Procesamiento de datos geográficos](https://geoprocesamiento-2020i.github.io/).
* Datos utilizados durante el curso: [Datos del curso GF-0604: Procesamiento de datos geográficos](https://github.com/geoprocesamiento-2020i/datos).

## Descripción general
En esta lección se cubren algunas de las capacidades de graficación del lenguaje de programación [R](https://www.r-project.org/). Se presentan ejemplos y ejercicios para varios tipos de gráficos estadísticos. 

## Objetivos
1. Conocer las principales bibliotecas de graficación del lenguaje de programación R.
2. Aprender algunas de las principales funciones de graficación de R para generar diferentes tipos de gráficos estadísticos, incluyendo:
    - Gráficos de dispersión.
    - Gráficos de líneas.
    - Gráficos de barras.
    - Histogramas.
    - Gráficos de cajas.

## Trabajo previo
Se recomienda leer el [capítulo 2 del libro _R Graphics Cookbook_, de Winston Chang](_R Graphics Cookbook_, de Winston Chang).

## Graficación en R
### Paquetes
R provee varios paquetes para generar gráficos. Aquí se estudiarán dos:  

* [graphics](http://search.r-project.org/R/library/graphics/html/graphics-package.html): es un paquete para gráficos sencillos, parte de la instalación base de R.
* [ggplot2](https://ggplot2.tidyverse.org/): es parte de [Tidyverse](https://www.tidyverse.org/), una colección de paquetes de R diseñada para utilizarse en [ciencia de datos](https://en.wikipedia.org/wiki/Data_science). Este paquete está basado en el libro [_The Grammar of Graphics_, de Leland Wilkinson et al.](https://www.springer.com/gp/book/9780387245447).

#### Carga de los paquetes
Antes de utilizarse, los paquetes deben cargarse con la función ```library()```.
```{r}
# graphics
library("graphics")

# ggplot2
library("ggplot2")

# opcionalmente, puede instalarse toda la colección tidyverse
library("tidyverse")
```

Si es necesario, ggplot2 y tidyverse pueden instalare con la función ```install.packages()```:
```
# ggplot2
install.packages("ggplot2")

# tidyverse
install.packages("tidyverse")
```

### Conjuntos de datos utilizados en los ejemplos
En los siguientes ejemplos y ejercicios, se utilizarán dos conjuntos de datos, los cuales se cargan en data frames con la función ```read.csv()``` y se visualizan con la función ```View()```:

#### Casos de Covid-19 en Centroamérica y República Dominicana
Este conjunto de datos tiene un registro por país con los casos (confirmados, fallecidos, activos, etc.) acumulados hasta la fecha en cada uno.
```{r}
ca_covid19 <- read.csv(file='https://raw.githubusercontent.com/geoprocesamiento-2020i/datos/master/covid19/casos/ca/ca-covid19.csv')

# Despliegue de los datos
View(ca_covid19)
```

#### Casos de Covid-19 en Costa Rica
Este conjunto de datos es un ejemplo de una [serie temporal](https://en.wikipedia.org/wiki/Time_series): una sucesión de datos medidos en determinados momentos y ordenados cronológicamente. Contiene un registro por día con las estadísticas de casos confirmados, fallecidos, activos y otras variables.
```{r}
cr_covid19 <- read.csv(file='https://raw.githubusercontent.com/geoprocesamiento-2020i/datos/master/covid19/casos/cr/cr-covid19-pais-acumulados.csv')

# Despliegue de los datos
View(cr_covid19)
```

### Tipos de gráficos

#### Gráficos de dispersión
Un [diagrama o gráfico de dispersión (_scatter plot_)](https://www.data-to-viz.com/graph/scatter.html) muestra la relación entre dos variables numéricas. Para cada punto de datos, el valor de la primera variable se representa en el eje X y el de la segunda variable en el eje Y.

La función ```plot()``` del paquete graphics recibe como argumentos los vectores de las variables que se desean graficar. El siguiente ejemplo usa las variables de casos descartados y casos confirmados de Covid-19 en Costa Rica.

```{r}
plot(cr_covid19$descartados, cr_covid19$confirmados)
```

Para mejorar el gráfico, pueden utilizarse otras opciones de la función ```plot()```:

```{r}
plot(cr_covid19$descartados, 
     cr_covid19$confirmados,
     main='Relación entre casos descartados y confirmados de Covid-19 en CR',
     xlab='Casos descartados',
     ylab='Casos confirmados'
     )
```

Con la función ```gglot()```, del paquete ggplot2, puede obtenerse un resultado similar:

```{r}
ggplot(cr_covid19, aes(x = descartados, y = confirmados)) +
  ggtitle('Relación entre casos descartados y confirmados de Covid-19 en CR') +
  geom_point()
```

La manera usual de usar ```gglot()``` es pasarle un data frame como argumento, especificando cuales columnas usar como valores de x e y. La primera parte, ```gglot()```, crea la base del gráfico (i.e. el canvas), mientras que ```geom_point()``` agrega una capa adicional, lo mismo que ```ggtitle()```.

#### Gráficos de líneas
Un [gráfico de líneas (_line graph_ o _line chart_)](https://www.data-to-viz.com/graph/line.html) muestra la evolución de una o varias variables numéricas. Los puntos de datos se conectan mediante segmentos de líneas rectas. Los gráficos de líneas son usados frecuentemente para visualizar tendencias de los datos en intervalos de tiempo (i.e. en series temporales).

Puede hacerse un gráfico de líneas con la función ```plot()``` al pasarle como argumento ```type="l"```.

```{r}
plot(cr_covid19$descartados, 
     cr_covid19$confirmados,
     main='Relación entre casos descartados y confirmados de Covid-19 en CR',
     xlab='Casos descartados',
     ylab='Casos confirmados',
     type="l"
     )
```

Si se desea agregar más líneas, o series de puntos, debe entonces llamarse a ```plot()``` para la primera variable (ej. la primera línea) y luego agregar las restantes series de líneas o de puntos con las funciones ```lines()``` y ```points()```.

```{r}
# línea de casos confirmados
plot(cr_covid19$descartados, 
     cr_covid19$confirmados,
     main='Relación entre casos descartados y confirmados/activos\n de Covid-19 en CR',
     xlab='Casos descartados',
     ylab='Casos confirmados/activos',
     type="l",
     col="blue"
     )
# puntos de casos confirmados
points(cr_covid19$descartados, cr_covid19$confirmados, col="blue")

# líneas y puntos de casos activos
lines(cr_covid19$descartados, cr_covid19$activos, col="red")
points(cr_covid19$descartados, cr_covid19$activos, col="red")
```

Con las funciones de ggplot2 puede conseguirse un resultado similar al crear el gráfico base con ```ggplot()``` y agregar las series de líneas y puntos con ```geom_line()``` y ```geom_point()```.

```{r}
ggplot(cr_covid19, aes(x=descartados)) + 
  geom_line(aes(y = confirmados), color = "blue") +
  geom_point(aes(y = confirmados), color = "blue") + 
  geom_line(aes(y = activos), color="red") +
  geom_point(aes(y = activos), color = "red") +
  ggtitle("Relación entre casos descartados y confirmados/activos de Covid-19 en CR") +
  xlab("Casos descartados") + ylab("Casos confirmados/activos")
```

#### Gráficos de barras